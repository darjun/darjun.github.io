/*
 v 0.1.23
 https://github.com/fooleap/disqus-php-api

 Copyright 2017 fooleap
 Released under the MIT license
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,g,m){d!=Array.prototype&&d!=Object.prototype&&(d[g]=m.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var d=0;return function(g){return $jscomp.SYMBOL_PREFIX+(g||"")+d++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var g=0;return $jscomp.iteratorPrototype(function(){return g<d.length?{done:!1,value:d[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.iteratorFromArray=function(d,g){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var m=0,h={next:function(){if(m<d.length){var l=m++;return{value:g(l,d[l]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};
$jscomp.polyfill=function(d,g,m,h){if(g){m=$jscomp.global;d=d.split(".");for(h=0;h<d.length-1;h++){var l=d[h];l in m||(m[l]={});m=m[l]}d=d[d.length-1];h=m[d];g=g(h);g!=h&&null!=g&&$jscomp.defineProperty(m,d,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Array.prototype.keys",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d){return d})}},"es6","es3");
(function(d){function g(a,c,b){var n=new XMLHttpRequest;n.open("GET",encodeURI(a));n.onreadystatechange=function(){4==n.readyState&&200==n.status&&c(n.responseText)};n.onerror=b;n.send();return n}function m(a,c,b,n){var e="string"==typeof c?c:Object.keys(c).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(c[a])}).join("&"),d=new XMLHttpRequest;d.open("POST",a);d.onreadystatechange=function(){4==d.readyState&&200==d.status&&b(d.responseText)};d.onerror=n;d.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded");d.send(e);return d}function h(a,c,b){[].forEach.call(a,function(a){a.addEventListener(c,b,!1)})}function l(a,c,b){[].forEach.call(a,function(a){a.removeEventListener(c,b,!1)})}var k=document,p=localStorage,r=k.scripts;r=r[r.length-1].src;var u=r.substring(0,r.lastIndexOf("/")),v=-1<navigator.userAgent.indexOf("Edge"),w=!!window.ActiveXObject||"ActiveXObject"in window;(function(a){"function"!==typeof a.matches&&(a.matches=a.msMatchesSelector||a.mozMatchesSelector||
a.webkitMatchesSelector||function(a){a=(this.document||this.ownerDocument).querySelectorAll(a);for(var b=0;a[b]&&a[b]!==this;)++b;return!!a[b]});"function"!==typeof a.closest&&(a.closest=function(a){for(var b=this;b&&1===b.nodeType;){if(b.matches(a))return b;b=b.parentNode}return null})})(window.Element.prototype);var t=function(a){this.dom=a;this.init()};t.prototype={init:function(){var a=this;a.name=p.getItem("name");a.email=p.getItem("email");a.url=p.getItem("url");a.avatar=p.getItem("avatar");
a.logged_in=p.getItem("logged_in");var c=a.dom.getElementsByClassName("comment-box");"true"==a.logged_in?[].forEach.call(c,function(b){b.querySelector(".comment-form-wrapper").classList.add("logged-in");b.querySelector(".comment-form-name").value=a.name;b.querySelector(".comment-form-email").value=a.email;b.querySelector(".comment-form-url").value=a.url;b.querySelector(".comment-avatar-image").src=a.avatar}):([].forEach.call(c,function(b){b.querySelector(".comment-form-wrapper").classList.remove("logged-in");
b.querySelector(".comment-form-name").value=a.name;b.querySelector(".comment-form-email").value=a.email;b.querySelector(".comment-form-url").value=a.url;b.querySelector(".comment-avatar-image").src=a.avatar?a.avatar:b.querySelector(".comment-avatar-image").src}),p.setItem("logged_in","false"))},reset:function(){p.setItem("logged_in","false");this.init()},submit:function(a){"false"==this.logged_in&&(p.setItem("name",a.name),p.setItem("email",a.email),p.setItem("url",a.url),p.setItem("avatar",a.avatar),
p.setItem("logged_in","true"),this.init())}};var f=function(a,c){var b=this;b.opts="object"==typeof c?c:a;b.dom=k.getElementById("string"==typeof a?a:"comment");b.opts.api="/"==b.opts.api.slice(-1)?b.opts.api.slice(0,-1):b.opts.api;b.opts.site=b.opts.site?b.opts.site:location.origin;b.opts.url?(a=b.opts.url.replace(b.opts.site,""),b.opts.url="/"!=a.slice(0,1)?"/"+a:a):b.opts.url=v||w?encodeURI(location.pathname)+encodeURI(location.search):location.pathname+location.search;b.opts.identifier=b.opts.identifier?
b.opts.identifier:b.opts.url;b.opts.link=b.opts.site+b.opts.url;b.opts.title=b.opts.title?b.opts.title:k.title;b.opts.slug=b.opts.slug?b.opts.slug.replace(/[^A-Za-z0-9_-]+/g,""):"";b.opts.desc=b.opts.desc?b.opts.desc:k.querySelector('[name="description"]')?k.querySelector('[name="description"]').content:"";b.opts.mode=b.opts.mode?b.opts.mode:1;b.opts.timeout=b.opts.timeout?b.opts.timeout:3E3;b.opts.toggle=b.opts.toggle?k.getElementById(b.opts.toggle):null;b.opts.badge=b.opts.badge?b.opts.badge:"\u7ba1\u7406\u5458";
b.opts.emoji_path=b.opts.emoji_path?b.opts.emoji_path:"https://assets-cdn.github.com/images/icons/emoji/unicode/";b.emoji_list=b.opts.emoji_list?b.opts.emoji_list:[{code:"smile",title:"\u7b11\u8138",unicode:"1f604"},{code:"mask",title:"\u751f\u75c5",unicode:"1f637"},{code:"joy",title:"\u7834\u6d95\u4e3a\u7b11",unicode:"1f602"},{code:"stuck_out_tongue_closed_eyes",title:"\u5410\u820c",unicode:"1f61d"},{code:"flushed",title:"\u8138\u7ea2",unicode:"1f633"},{code:"scream",title:"\u6050\u60e7",unicode:"1f631"},
{code:"pensive",title:"\u5931\u671b",unicode:"1f614"},{code:"unamused",title:"\u65e0\u8bed",unicode:"1f612"},{code:"grin",title:"\u9732\u9f7f\u7b11",unicode:"1f601"},{code:"heart_eyes",title:"\u8272",unicode:"1f60d"},{code:"sweat",title:"\u6c57",unicode:"1f613"},{code:"smirk",title:"\u5f97\u610f",unicode:"1f60f"},{code:"relieved",title:"\u6ee1\u610f",unicode:"1f60c"},{code:"rolling_eyes",title:"\u7ffb\u767d\u773c",unicode:"1f644"},{code:"ok_hand",title:"OK",unicode:"1f44c"},{code:"v",title:"\u80dc\u5229",
unicode:"270c"}];b.opts.emoji_preview&&g(u+"/eac.min.json",function(a){b.eac=JSON.parse(a)},function(){});b.stat={current:"idisqus",loaded:!1,loading:!1,editing:!1,offsetTop:0,thread:null,next:null,message:null,mediaHtml:null,root:[],count:0,users:[],imageSize:[],disqusLoaded:!1};window.disqus_config=function(){this.page.identifier=b.opts.identifier;this.page.title=b.opts.title;this.page.url=b.opts.link;this.callbacks.onReady.push(function(){b.stat.current="disqus";b.stat.disqusLoaded=!0;b.dom.querySelector("#idisqus").style.display=
"none";b.dom.querySelector("#disqus_thread").style.display="block";3==b.opts.mode&&b.opts.toggle&&(b.opts.toggle.disabled="",b.opts.toggle.checked=!0,b.opts.toggle.addEventListener("change",b.handle.toggle,!1))})};b.opts.init&&b.init()};f.prototype.timeAgo=function(){var a={prefix:"",suffix:"\u524d",seconds:"\u51e0\u79d2",minute:"1\u5206\u949f",minutes:"%d\u5206\u949f",hour:"1\u5c0f\u65f6",hours:"%d\u5c0f\u65f6",day:"1\u5929",days:"%d\u5929",month:"1\u4e2a\u6708",months:"%d\u4e2a\u6708",year:"1\u5e74",
years:"%d\u5e74"},c=function(b,c){return a[b]&&a[b].replace(/%d/i,Math.abs(Math.round(c)))},b=function(b){if(b){b=b.replace(/\.\d+/,"");b=b.replace(/-/,"/").replace(/-/,"/");b=b.replace(/T/," ").replace(/Z/," UTC");b=b.replace(/([\+\-]\d\d):?(\d\d)/," $1$2");b=new Date(1E3*b||b);b=.001*((new Date).getTime()-b)>>0;var e=b/60,d=e/60,n=d/24,f=n/365;return a.prefix+(45>b&&c("seconds",b)||90>b&&c("minute",1)||45>e&&c("minutes",e)||90>e&&c("hour",1)||24>d&&c("hours",d)||42>d&&c("day",1)||30>n&&c("days",
n)||45>n&&c("month",1)||365>n&&c("months",n/30)||1.5>f&&c("year",1)||c("years",f))+a.suffix}},n=this.dom.querySelectorAll(".comment-item-time"),e;for(e in n){var d=n[e];"object"===typeof d&&(d.title=new Date(d.getAttribute("datetime")),d.innerHTML=b(d.getAttribute("datetime")))}setTimeout(this.timeAgo.bind(this),6E4)};f.prototype.init=function(){var a=this;if(a.dom){var c="";a.emoji_list.forEach(function(b){c+='<li class="emojione-item" title="'+b.title+'" data-code=":'+b.code+':"><img class="emojione-item-image" src="'+
a.opts.emoji_path+b.unicode+'.png" /></li>'});a.dom.innerHTML='<div class="comment loading" id="idisqus">\n    <div class="loading-container" data-tip="\u6b63\u5728\u52a0\u8f7d\u8bc4\u8bba\u2026\u2026"><svg class="loading-bg" width="72" height="72" viewBox="0 0 720 720" version="1.1" xmlns="http://www.w3.org/2000/svg"><path class="ring" fill="none" stroke="#9d9ea1" d="M 0 -260 A 260 260 0 1 1 -80 -260" transform="translate(400,400)" stroke-width="50" /><polygon transform="translate(305,20)" points="50,0 0,100 18,145 50,82 92,145 100,100" style="fill:#9d9ea1"/></svg></div>\n    <div class="comment-header"><span class="comment-header-item" id="comment-count">\u8bc4\u8bba</span><a target="_blank" class="comment-header-item" id="comment-link">Disqus \u8ba8\u8bba\u533a</a></div>\n    <div class="comment-box">\n        <div class="comment-avatar avatar"><img class="comment-avatar-image" src="https://a.disquscdn.com/images/noavatar92.png"></div>\n        <div class="comment-form">\n            <div class="comment-form-wrapper">\n                <textarea class="comment-form-textarea" placeholder="\u52a0\u5165\u8ba8\u8bba\u2026\u2026"></textarea>\n                <div class="comment-form-alert"></div>\n                <div class="comment-image">\n                    <ul class="comment-image-list"></ul>\n                    <div class="comment-image-progress">\n                        <div class="comment-image-loaded"></div>\n                    </div>\n                </div>\n                <div class="comment-actions">\n                    <div class="comment-actions-group">\n                        <input id="emoji-input" class="comment-actions-input" type="checkbox"> \n                        <label class="comment-actions-label emojione" for="emoji-input" title="\u9009\u62e9\u8868\u60c5">\n                            <svg class="icon" fill="#c2c6cc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">\n                                <path d="M512 1024c-282.713043 0-512-229.286957-512-512s229.286957-512 512-512c282.713043 0 512 229.286957 512 512S792.486957 1024 512 1024zM512 44.521739c-258.226087 0-467.478261 209.252174-467.478261 467.478261 0 258.226087 209.252174 467.478261 467.478261 467.478261s467.478261-209.252174 467.478261-467.478261C979.478261 253.773913 768 44.521739 512 44.521739z"></path>\n                                <path d="M801.391304 554.295652c0 160.278261-129.113043 289.391304-289.391304 289.391304s-289.391304-129.113043-289.391304-289.391304L801.391304 554.295652z"></path>\n                                <path d="M674.504348 349.495652m-57.878261 0a2.6 2.6 0 1 0 115.756522 0 2.6 2.6 0 1 0-115.756522 0Z"></path>\n                                <path d="M347.269565 349.495652m-57.878261 0a2.6 2.6 0 1 0 115.756522 0 2.6 2.6 0 1 0-115.756522 0Z"></path>\n                            </svg>\n                            <ul class="emojione-list">'+
c+'</ul>\n                        </label>\n                        <input id="upload-input" class="comment-actions-input comment-image-input" type="file" accept="image/*" name="file"> \n                        <label class="comment-actions-label" for="upload-input" title="\u4e0a\u4f20\u56fe\u7247">\n                            <svg class="icon" fill="#c2c6cc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">\n                                <path d="M15.515152 15.515152 15.515152 15.515152 15.515152 15.515152Z"></path>\n                                <path d="M15.515152 139.636364l0 806.787879 992.969697 0 0-806.787879-992.969697 0zM946.424242 884.363636l-868.848485 0 0-682.666667 868.848485 0 0 682.666667zM698.181818 356.848485c0-51.417212 41.673697-93.090909 93.090909-93.090909s93.090909 41.673697 93.090909 93.090909c0 51.417212-41.673697 93.090909-93.090909 93.090909s-93.090909-41.673697-93.090909-93.090909zM884.363636 822.30303l-744.727273 0 186.181818-496.484848 248.242424 310.30303 124.121212-93.090909z"></path>\n                            </svg>\n                        </label>\n                    </div>\n                    <div class="comment-actions-form">\n                        <label class="comment-actions-label exit" title="\u91cd\u7f6e\u8bbf\u5ba2\u4fe1\u606f">\n                            <svg class="icon" fill="#c2c6cc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48" height="48">\n                                <path d="M348.870666 210.685443l378.570081 0c32.8205 0 58.683541 26.561959 58.683541 58.683541 0 162.043606 0 324.804551 0 486.848157 0 32.81129-26.561959 58.674331-58.683541 58.674331L348.870666 814.891472c-10.477632 0-18.850323-8.363482-18.850323-18.841114l0-37.728276c0-10.477632 8.372691-18.841114 18.850323-18.841114l343.645664 0c10.477632 0 18.850323-8.372691 18.850323-18.850323L711.366653 304.983109c0-10.477632-8.372691-18.841114-18.850323-18.841114L348.870666 286.141996c-10.477632 0-18.850323-8.363482-18.850323-18.841114l0-37.728276C329.98248 219.095997 338.393034 210.685443 348.870666 210.685443z"></path>\n                                <path d="M128.152728 526.436804l112.450095 112.450095c6.985088 6.985088 19.567661 6.985088 26.552749 0l26.561959-26.561959c6.985088-6.985088 6.985088-19.567661 0-26.552749l-34.925441-34.925441L494.168889 550.84675c10.477632 0 18.850323-8.372691 18.850323-18.850323l0-37.719066c0-10.477632-8.372691-18.850323-18.850323-18.850323L258.754229 475.427036l34.925441-34.925441c6.985088-6.985088 6.985088-19.567661 0-26.552749l-26.561959-26.524097c-6.985088-6.985088-19.567661-6.985088-26.552749 0L128.152728 499.875868C120.431883 506.859933 120.431883 519.451716 128.152728 526.436804z"></path>\n                            </svg>\n                        </label>\n                        <button class="comment-form-submit">\n                            <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">\n                                <path d="M565.747623 792.837176l260.819261 112.921839 126.910435-845.424882L66.087673 581.973678l232.843092 109.933785 562.612725-511.653099-451.697589 563.616588-5.996574 239.832274L565.747623 792.837176z" fill="#ffffff"></path>\n                            </svg>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div class="comment-login"><input class="comment-form-input comment-form-name" type="text" placeholder="\u540d\u5b57\uff08\u5fc5\u586b\uff09" autocomplete="name"><input class="comment-form-input comment-form-email" type="email" placeholder="\u90ae\u7bb1\uff08\u5fc5\u586b\uff09" autocomplete="email"><input class="comment-form-input comment-form-url" type="url" placeholder="\u7f51\u5740\uff08\u53ef\u9009\uff09" autocomplete="url"></div>\n        </div>\n    </div>\n    <ul id="comments" class="comment-list"></ul>\n    <a href="javascript:;" class="comment-loadmore">\u52a0\u8f7d\u66f4\u591a</a>\n</div>\n<div class="comment" id="disqus_thread"></div>';
a.guest=new t(a.dom);a.box=a.dom.querySelector(".comment-box").outerHTML.replace(/<label class="comment-actions-label exit"(.|\n)*<\/label>\n/,"").replace("comment-form-wrapper","comment-form-wrapper editing").replace(/\u52a0\u5165\u8ba8\u8bba\u2026\u2026/,"");a.handle={guestReset:a.guest.reset.bind(a.guest),loadMore:a.loadMore.bind(a),post:a.post.bind(a),postThread:a.postThread.bind(a),remove:a.remove.bind(a),show:a.show.bind(a),toggle:a.toggle.bind(a),upload:a.upload.bind(a),verify:a.verify.bind(a),
jump:a.jump.bind(a),mention:a.mention.bind(a),keySelect:a.keySelect.bind(a),field:a.field,focus:a.focus,input:a.input};switch(a.opts.mode){case 1:a.disqus();break;case 2:a.getlist();break;case 3:a.getlist();a.disqus();break;default:a.disqus()}}};f.prototype.toggle=function(){"disqus"==this.stat.current?(this.stat.current="idisqus",this.dom.querySelector("#idisqus").style.display="block",this.dom.querySelector("#disqus_thread").style.display="none"):this.disqus()};f.prototype.disqus=function(){var a=
this;a.dom.querySelector(".loading-container");if(a.stat.disqusLoaded)a.stat.current="disqus",a.dom.querySelector("#idisqus").style.display="none",a.dom.querySelector("#disqus_thread").style.display="block";else{var c=k.createElement("script");c.src="//"+a.opts.forum+".disqus.com/embed.js";c.dataset.timestamp=Date.now();c.onload=function(){a.stat.disqusLoaded=!0};c.onerror=function(){1==a.opts.mode&&a.getlist()};var b=new XMLHttpRequest;b.open("GET","//disqus.com/next/config.json?"+Date.now(),!0);
b.timeout=a.opts.timeout;b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(k.head||k.body).appendChild(c)};b.ontimeout=function(){b.abort();1==a.opts.mode&&a.getlist()};b.onerror=function(){1==a.opts.mode&&a.getlist()};b.send()}};f.prototype.count=function(){var a=this,c=k.querySelectorAll("[data-disqus-url]"),b=c.length;if(0<b){for(var n=[],e=0;e<b;e++)n[e]=c[e].dataset.disqusUrl.replace(a.opts.site,"");g(a.opts.api+"/count.php?links="+n.join(","),function(b){JSON.parse(b).response.forEach(function(b){var c=
b.link.replace(a.opts.site,"");c="/"!=c.slice(0,1)?"/"+c:c;if(c=k.querySelector('[data-disqus-url$="'+c+'"]'))c.innerHTML=b.posts,c.dataset.disqusCount=b.posts})},function(){console.log("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff01")})}};f.prototype.popular=function(){var a=this;a.opts.popular&&g(a.opts.api+"/popular.php",function(c){c=JSON.parse(c);if(0==c.code){var b="";c.response.forEach(function(c){b+='<li><a href="'+c.link.replace(a.opts.site,"")+'" title="'+c.title+'">'+c.title+"</a></li>"});
a.opts.popular.innerHTML=b}},function(){console.log("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff01")})};f.prototype.getlist=function(){var a=this;a.stat.loading=!0;a.dom.querySelector("#idisqus").style.display="block";a.dom.querySelector("#disqus_thread").style.display="none";g(a.opts.api+"/getcomments.php?link="+a.opts.url+(a.stat.next?"&cursor="+a.stat.next:""),function(c){c=JSON.parse(c);c.auth||alert("\u8ba4\u8bc1\u51fa\u9519\uff0c\u8bf7\u67e5\u770b\u540e\u7aef\u914d\u7f6e\u4e2d\uff0cDisqus \u5e10\u53f7\u5bc6\u7801\u662f\u5426\u586b\u5199\u6709\u8bef\u3002");
if(0===c.code){a.stat.offsetTop=k.documentElement.scrollTop||k.body.scrollTop;a.stat.thread=c.thread;a.stat.count=c.posts;a.dom.querySelector("#idisqus").classList.remove("loading");a.dom.querySelector("#comment-link").href=c.link;a.dom.querySelector("#comment-count").innerHTML=a.stat.count+" \u6761\u8bc4\u8bba";var b=a.dom.querySelector(".comment-loadmore"),d=c.response?c.response:[];a.stat.root=[];d.forEach(function(b){a.load(b);b.parent||a.stat.root.unshift(b.id)});c.cursor.hasPrev?a.stat.root.forEach(function(b){a.dom.querySelector(".comment-list").appendChild(a.dom.querySelector("#comment-"+
b))}):(b.addEventListener("click",a.handle.loadMore,!1),a.dom.querySelector(".exit").addEventListener("click",a.handle.guestReset,!1),a.dom.querySelector(".comment-form-textarea").addEventListener("blur",a.handle.focus,!1),a.dom.querySelector(".comment-form-textarea").addEventListener("focus",a.handle.focus,!1),a.dom.querySelector(".comment-form-textarea").addEventListener("input",a.handle.input,!1),a.dom.querySelector(".comment-form-textarea").addEventListener("keyup",a.handle.mention,!1),a.dom.querySelector(".comment-form-email").addEventListener("blur",
a.handle.verify,!1),a.dom.querySelector(".comment-form-submit").addEventListener("click",a.handle.post,!1),a.dom.querySelector(".comment-image-input").addEventListener("change",a.handle.upload,!1),h(a.dom.getElementsByClassName("emojione-item"),"click",a.handle.field));c.cursor.hasNext?(a.stat.next=c.cursor.next,b.classList.remove("loading")):(a.stat.next=null,b.classList.add("hide"));0!=d.length&&(window.scrollTo(0,a.stat.offsetTop),a.timeAgo(),!/^#disqus|^#comment/.test(location.hash)||c.cursor.hasPrev||
a.stat.disqusLoaded||(c=a.dom.querySelector("#idisqus "+location.hash),window.scrollBy(0,c.getBoundingClientRect().top)),a.stat.loading=!1,a.stat.loaded=!0)}else 2===c.code&&a.create()},function(){alert("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u670d\u52a1\u5668\u8bbe\u7f6e\u3002")})};f.prototype.load=function(a){var c=this,b=c.dom.querySelector('.comment-item[data-id="'+a.parent+'"]'),d={username:a.username,name:a.name,avatar:a.avatar};a.username&&-1==c.stat.users.map(function(a){return a.username}).indexOf(a.username)&&
c.stat.users.push(d);b=a.parent?{name:'<a class="comment-item-pname" href="#'+b.id+'"><svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M1.664 902.144s97.92-557.888 596.352-557.888V129.728L1024 515.84l-425.984 360.448V628.8c-270.464 0-455.232 23.872-596.352 273.28"></path></svg>'+b.dataset.name+"</a>",dom:b.querySelector(".comment-item-children"),insert:"afterbegin"}:{name:"",dom:c.dom.querySelector(".comment-list"),
insert:"preview"==a.id||a.isPost?"afterbegin":"beforeend"};var e="";0<a.media.length&&(a.media.forEach(function(a){e+='<a class="comment-item-imagelink" target="_blank" href="'+a+'" ><img class="comment-item-image" src="'+a+'"></a>'}),e='<div class="comment-item-images">'+e+"</div>");d='<li class="comment-item" data-id="'+a.id+'" data-name="'+a.name+'" id="comment-'+a.id+'"><div class="comment-item-body"><a class="comment-item-avatar" href="#comment-'+a.id+'"><img src="'+a.avatar+'"></a><div class="comment-item-main"><div class="comment-item-header"><a class="comment-item-name" title="'+
a.name+'" rel="nofollow" target="_blank" href="'+(a.url?a.url:"javascript:;")+'">'+a.name+"</a>"+(a.isMod?'<span class="comment-item-badge">'+c.opts.badge+"</span>":"")+b.name+'<span class="comment-item-bullet"> \u2022 </span><time class="comment-item-time" datetime="'+a.createdAt+'"></time></div><div class="comment-item-content">'+a.message+e+'</div><div class="comment-item-footer">'+(a.isPost?'<span class="comment-item-manage"><a class="comment-item-edit" href="javascript:;">\u7f16\u8f91</a><span class="comment-item-bullet"> \u2022 </span><a class="comment-item-delete" href="javascript:;">\u5220\u9664</a><span class="comment-item-bullet"> \u2022 </span></span>':
"")+'<a class="comment-item-reply" href="javascript:;">\u56de\u590d</a> </div></div></div><ul class="comment-item-children"></ul></li>';a.isDeleted&&(d='<li class="comment-item" data-id="'+a.id+'" id="comment-'+a.id+'" data-name="\u5df2\u5220\u9664"><div class="comment-item-body"><a class="comment-item-avatar" href="#comment-'+a.id+'"><img src="'+a.avatar+'"></a><div class="comment-item-main" data-message="\u6b64\u8bc4\u8bba\u5df2\u88ab\u5220\u9664\u3002"></div></div><ul class="comment-item-children"></ul></li>');
c.dom.querySelector('.comment-item[data-id="'+a.id+'"]')?c.dom.querySelector('.comment-item[data-id="'+a.id+'"]').outerHTML=d:b.dom.insertAdjacentHTML(b.insert,d);a.isDeleted||(c.dom.querySelector('.comment-item[data-id="'+a.id+'"] .comment-item-reply').addEventListener("click",c.handle.show,!1),c.dom.querySelector('.comment-item[data-id="'+a.id+'"] .comment-item-avatar').addEventListener("click",c.handle.jump,!1),a.parent&&c.dom.querySelector('.comment-item[data-id="'+a.id+'"] .comment-item-pname').addEventListener("click",
c.handle.jump,!1));if(a.isPost&&!c.stat.editing){var f=c.dom.querySelector('.comment-item[data-id="'+a.id+'"]');f.querySelector(".comment-item-footer").insertAdjacentHTML("beforeend",'<span class="comment-item-tips">\u9875\u9762\u5237\u65b0\u524d\uff0c\u5341\u5206\u949f\u5185\u53ef\u7f16\u8f91\u6216\u5220\u9664</span>');setTimeout(function(){f.querySelector(".comment-item-tips")&&(f.querySelector(".comment-item-tips").outerHTML="")},5E3);var h=setTimeout(function(){f.querySelector(".comment-item-manage")&&
(f.querySelector(".comment-item-manage").outerHTML="")},6E5);f.querySelector(".comment-item-delete").addEventListener("click",function(b){var d={id:a.id};b.currentTarget.innerHTML="\u5220\u9664\u4e2d";m(c.opts.api+"/removecomment.php",d,function(a){a=JSON.parse(a);0===a.code?1==a.response.isDeleted?f.outerHTML="":(alert(a.response.message),f.querySelector(".comment-item-manage").outerHTML=""):2===a.code&&(alert(a.response),f.querySelector(".comment-item-manage").outerHTML="")},function(){alert("\u5220\u9664\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")});
clearTimeout(h)},!1);f.querySelector(".comment-item-edit").addEventListener("click",function(){c.stat.editing=a;c.edit(a)},!1)}};f.prototype.loadMore=function(a){this.stat.loading||(a.currentTarget.classList.add("loading"),this.getlist())};f.prototype.focus=function(a){a=a.currentTarget.closest(".comment-form-wrapper");a.classList.add("editing");a.classList.contains("focus")?a.classList.remove("focus"):a.classList.add("focus")};f.prototype.input=function(a){a.currentTarget.closest(".comment-form").querySelector(".comment-form-alert").innerHTML=
""};f.prototype.mention=function(a){var c=this,b=a.currentTarget,d=b.selectionStart,e=b.value.slice(0,d).lastIndexOf("@"),f=b.value.slice(e,d),g=c.dom.querySelector(".mention-user");if(0==f.search(/^@\w+$|^@$/)){if(38!=a.keyCode&&40!=a.keyCode){a=c.stat.users.filter(function(a){var b=new RegExp(f.slice(1),"i");return-1<a.username.search(b)});var m=c.getCaretCoord(b),l="",k="";0<a.length?(a.forEach(function(a,b){l+='<li class="mention-user-item'+(0==b?" active":"")+'" data-username="'+a.username+'"><img class="mention-user-avatar" src="'+
a.avatar+'"><div class="mention-user-username">'+a.username+'</div><div class="mention-user-name">'+a.name+"</div></li>"}),g?(g.innerHTML='<ul class="mention-user-list">'+l+"</ul>",g.style.left=m.left+"px",g.style.top=m.top+"px"):(k='<div class="mention-user" style="left:'+m.left+"px;top:"+m.top+'px"><ul class="mention-user-list">'+l+"</ul></div>",c.dom.querySelector("#idisqus").insertAdjacentHTML("beforeend",k)),h(c.dom.getElementsByClassName("mention-user-item"),"mouseover",function(){c.dom.querySelector(".mention-user-item.active").classList.remove("active");
this.classList.add("active")}),h(c.dom.getElementsByClassName("mention-user-item"),"click",function(){var a="@"+this.dataset.username+" ";b.value=b.value.slice(0,e)+a+b.value.slice(d);c.dom.querySelector(".mention-user").outerHTML="";b.focus();b.setSelectionRange(e+a.length,e+a.length);b.removeEventListener("keydown",c.handle.keySelect,!1)}),b.addEventListener("keydown",c.handle.keySelect,!1)):g&&(g.outerHTML="",b.removeEventListener("keydown",c.handle.keySelect,!1))}}else g&&(g.outerHTML="",b.removeEventListener("keydown",
c.handle.keySelect,!1))};f.prototype.getCaretCoord=function(a){var c=a.selectionEnd,b=k.createElement("div"),d=k.createElement("span"),e=getComputedStyle(a);[].forEach.call(e,function(a){b.style[a]=e[a]});b.style.position="absolute";this.dom.appendChild(b);b.textContent=a.value.substr(0,c);d.textContent=a.value.substr(c)||".";b.appendChild(d);a={top:a.offsetTop-a.scrollTop+d.offsetTop+parseFloat(e.lineHeight),left:a.offsetLeft-a.scrollLeft+d.offsetLeft};this.dom.removeChild(b);return a};f.prototype.keySelect=
function(a){var c=a.currentTarget,b=c.selectionStart,d=c.value.slice(0,b).lastIndexOf("@");c.value.slice(d,b);this.dom.querySelector(".mention-user");var e=this.dom.querySelector(".mention-user-item.active");switch(a.keyCode){case 13:e="@"+e.dataset.username+" ";c.value=c.value.slice(0,d)+e+c.value.slice(b);c.setSelectionRange(d+e.length,d+e.length);this.dom.querySelector(".mention-user").outerHTML="";c.removeEventListener("keydown",this.handle.keySelect,!1);a.preventDefault();break;case 38:e.previousSibling&&
(e.previousSibling.classList.add("active"),e.classList.remove("active"));a.preventDefault();break;case 40:e.nextSibling&&(e.nextSibling.classList.add("active"),e.classList.remove("active")),a.preventDefault()}};f.prototype.jump=function(a){var c=a.currentTarget.href,b=k.createElement("a");b.href=c;c=b.hash;b=this.dom.querySelector("#idisqus "+c);history.replaceState(void 0,void 0,c);window.scrollBy(0,b.getBoundingClientRect().top);a.preventDefault()};f.prototype.field=function(a){var c=a.currentTarget;
a=c.closest(".comment-form").querySelector(".comment-form-textarea");var b=a.selectionStart;c=0==b?c.dataset.code+" ":" "+c.dataset.code+" ";a.value=a.value.slice(0,b)+c+a.value.slice(b);a.focus();a.setSelectionRange(b+c.length,b+c.length)};f.prototype.show=function(a){var c=a.currentTarget;a=c.closest(".comment-item");var b=this.dom.querySelector(".comment-item .comment-box:not([data-current-id])");if(b){var d=b.closest(".comment-item").querySelector(".comment-item-cancel");d.outerHTML=d.outerHTML.replace("cancel",
"reply");b.outerHTML=""}"comment-item-reply"==c.className&&(c.outerHTML=c.outerHTML.replace("reply","cancel"),c=this.box.replace(/emoji-input/g,"emoji-input-"+a.dataset.id).replace(/upload-input/g,"upload-input-"+a.dataset.id),a.querySelector(".comment-item-children").insertAdjacentHTML("beforebegin",c),this.guest.init(),a.querySelector(".comment-form-textarea").addEventListener("blur",this.handle.focus,!1),a.querySelector(".comment-form-textarea").addEventListener("focus",this.handle.focus,!1),a.querySelector(".comment-form-textarea").addEventListener("keyup",
this.handle.mention,!1),a.querySelector(".comment-form-textarea").addEventListener("input",this.handle.input,!1),a.querySelector(".comment-form-email").addEventListener("blur",this.handle.verify,!1),a.querySelector(".comment-form-submit").addEventListener("click",this.handle.post,!1),a.querySelector(".comment-image-input").addEventListener("change",this.handle.upload,!1),h(a.getElementsByClassName("emojione-item"),"click",this.handle.field),a.querySelector(".comment-form-textarea").focus());h(this.dom.getElementsByClassName("comment-item-reply"),
"click",this.handle.show);h(this.dom.getElementsByClassName("comment-item-cancel"),"click",this.handle.show)};f.prototype.verify=function(a){var c=this;a=a.currentTarget.closest(".comment-box");var b=a.querySelector(".comment-avatar-image"),d=a.querySelector(".comment-form-email");a.querySelector(".comment-form-alert");/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(d.value)&&g(c.opts.api+"/getgravatar.php?email="+d.value,function(a){"false"==a?c.errorTips("\u60a8\u6240\u586b\u5199\u7684\u90ae\u7bb1\u5730\u5740\u6709\u8bef\u3002",
d):b.src=a},function(){})};f.prototype.upload=function(a){var c=this;a=a.currentTarget;var b=a.closest(".comment-form"),d=b.querySelector(".comment-image-progress"),e=b.querySelector(".comment-image-loaded"),f=b.querySelector(".comment-form-wrapper"),g=b.querySelector(".comment-form-alert");g.innerHTML="";if(0!==a.files.length){var h=a.files[0].size;if(5E6<h)g.innerHTML="\u8bf7\u9009\u62e9 5M \u4ee5\u4e0b\u56fe\u7247\u3002",setTimeout(function(){g.innerHTML=""},3E3);else if(-1==c.stat.imageSize.indexOf(h)){d.style.width=
"80px";f.classList.add("expanded");var m=new FormData;m.append("file",a.files[0]);var l=a.files[0].name,k,q=new XMLHttpRequest;q.onreadystatechange=function(){if(4==q.readyState&&200==q.status){var a=JSON.parse(q.responseText);if(0==a.code){c.stat.imageSize.push(h);var d=a.response[l].url;a=new Image;a.src=d;a.onload=function(){k.innerHTML='<img class="comment-image-object" src="'+d+'">';k.dataset.imageUrl=d;k.classList.remove("loading");k.addEventListener("click",c.handle.remove,!1)}}else g.innerHTML=
"\u56fe\u7247\u4e0a\u4f20\u51fa\u9519\u3002",k.innerHTML="",b.getElementsByClassName("comment-image-item").length&&f.classList.remove("expanded"),setTimeout(function(){g.innerHTML=""},3E3)}};q.upload.addEventListener("progress",function(a){e.style.width=Math.ceil(a.loaded/a.total*100)+"%"},!1);q.upload.addEventListener("load",function(a){e.style.width=0;d.style.width=0;a='<li class="comment-image-item loading" data-image-size="'+h+'">\n    <svg version="1.1" class="comment-image-object" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n        width="24px" height="30px" viewBox="0 0 24 30" style="enable-background: new 0 0 50 50;" xml:space="preserve">\n        <rect x="0" y="10" width="4" height="10" fill="rgba(127,145,158,1)" opacity="0.2">\n            <animate attributeName="opacity" attributeType="XML" values="0.2; 1; .2" begin="0s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="height" attributeType="XML" values="10; 20; 10" begin="0s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="y" attributeType="XML" values="10; 5; 10" begin="0s" dur="0.6s" repeatCount="indefinite" />\n        </rect>\n        <rect x="8" y="10" width="4" height="10" fill="rgba(127,145,158,1)" opacity="0.2">\n            <animate attributeName="opacity" attributeType="XML" values="0.2; 1; .2" begin="0.15s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="height" attributeType="XML" values="10; 20; 10" begin="0.15s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="y" attributeType="XML" values="10; 5; 10" begin="0.15s" dur="0.6s" repeatCount="indefinite" />\n        </rect>\n        <rect x="16" y="10" width="4" height="10" fill="rgba(127,145,158,1)" opacity="0.2">\n            <animate attributeName="opacity" attributeType="XML" values="0.2; 1; .2" begin="0.3s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="height" attributeType="XML" values="10; 20; 10" begin="0.3s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="y" attributeType="XML" values="10; 5; 10" begin="0.3s" dur="0.6s" repeatCount="indefinite" />\n        </rect>\n    </svg>\n</li>\n';
b.querySelector(".comment-image-list").insertAdjacentHTML("beforeend",a);k=b.querySelector('[data-image-size="'+h+'"]')},!1);q.open("POST",c.opts.api+"/upload.php",!0);q.send(m)}else g.innerHTML="\u8bf7\u52ff\u9009\u62e9\u5df2\u5b58\u5728\u7684\u56fe\u7247\u3002",setTimeout(function(){g.innerHTML=""},3E3)}};f.prototype.remove=function(a){var c=this,b=a.currentTarget.closest(".comment-image-item");a=a.currentTarget.closest(".comment-form-wrapper");b.outerHTML="";c.stat.imageSize=[];b=a.getElementsByClassName("comment-image-item");
[].forEach.call(b,function(a,b){c.stat.imageSize[b]=a.dataset.imageSize});0==c.stat.imageSize.length&&a.classList.remove("expanded");a.querySelector(".comment-image-input").value=""};f.prototype.errorTips=function(a,c){var b=this;"true"==b.guest.logged_in&&b.handle.guestReset();var d=b.dom.querySelector("#idisqus"),e=b.dom.querySelector(".comment-form-error");e&&(e.outerHTML="");d.insertAdjacentHTML("beforeend",'<div class="comment-form-error" style="top:'+c.offsetTop+"px;left:"+c.offsetLeft+'px;">'+
a+"</div>");setTimeout(function(){var a=b.dom.querySelector(".comment-form-error");a&&(a.outerHTML="")},3E3)};f.prototype.post=function(a){var c=this,b=a.currentTarget.closest(".comment-box[data-current-id]")||a.currentTarget.closest(".comment-item")||a.currentTarget.closest(".comment-box");a=b.querySelector(".comment-form-textarea").value;var d=b.dataset.id?b.dataset.id:"",e=b.getElementsByClassName("comment-image-item"),f=[],g="";[].forEach.call(e,function(a,b){f[b]=a.dataset.imageUrl;g+=" "+a.dataset.imageUrl});
if(!b.dataset.currentId){e=b.querySelector(".comment-form-name");var h=b.querySelector(".comment-form-email"),k=b.querySelector(".comment-form-url"),l={name:e.value,email:h.value,url:k.value.replace(/\s/g,""),avatar:b.querySelector(".comment-avatar-image").src},p=b.querySelector(".comment-form-alert");if(/^\s*$/i.test(l.name)){c.errorTips("\u540d\u5b57\u4e0d\u80fd\u4e3a\u7a7a\u3002",e);return}if(/^\s*$/i.test(l.email)){c.errorTips("\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a\u3002",h);return}if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(l.email)){c.errorTips("\u8bf7\u6b63\u786e\u586b\u5199\u90ae\u7bb1\u3002",
h);return}if(!/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)(([A-Za-z0-9-~]+)\.)+([A-Za-z0-9-~\/])+$|^\s*$/i.test(l.url)){c.errorTips("\u8bf7\u6b63\u786e\u586b\u5199\u7f51\u5740\u3002",k);return}c.guest.submit(l);c.stat.message||c.stat.mediaHtml||(c.box=c.dom.querySelector(".comment-box").outerHTML.replace(/<label class="comment-actions-label exit"(.|\n)*<\/label>\n/,"").replace("comment-form-wrapper","comment-form-wrapper editing").replace(/\u52a0\u5165\u8ba8\u8bba\u2026\u2026/,""));if(!c.guest.name&&
!c.guest.email)return;if(0==f.length&&/^\s*$/i.test(a)){p.innerHTML="\u8bc4\u8bba\u4e0d\u80fd\u4e3a\u7a7a\u6216\u7a7a\u683c\u3002";b.querySelector(".comment-form-textarea").focus();return}var q=a;c.opts.emoji_preview?q=q.replace(/:([-+\w]+):/g,function(a){var b=a.replace(/:/g,"");return c.eac[b]?'<img class="emojione" width="24" height="24" alt="'+b+'" title=":'+b+':" src="'+c.opts.emoji_path+c.eac[b]+'.png">':a}):c.emoji_list.forEach(function(a){q=q.replace(":"+a.code+":",'<img class="emojione" width="24" height="24" src="'+
c.opts.emoji_path+a.unicode+'.png" />')});e={url:c.guest.url?c.guest.url:"",isMod:!1,username:null,name:c.guest.name,avatar:c.guest.avatar,id:"preview",parent:d,createdAt:(new Date).toJSON(),message:"<p>"+q+"</p>",media:f};c.load(e);c.timeAgo();c.stat.message=a;c.stat.mediaHtml=b.querySelector(".comment-image-list").innerHTML;d?b.querySelector(".comment-item-cancel").click():(b.querySelector(".comment-form-textarea").value="",b.querySelector(".comment-image-list").innerHTML="",b.querySelector(".comment-form-wrapper").classList.remove("expanded",
"editing"))}if(e=a.match(/@\w+/g))e=e.filter(function(a){return-1<c.stat.users.map(function(a){return a.username}).indexOf(a.slice(1))}),0<e.length&&(e=new RegExp("("+e.join("|")+")","g"),a=a.replace(e,"$1:disqus"));a+=g;b.dataset.currentId?(a={id:b.dataset.currentId,message:a},m(c.opts.api+"/updatecomment.php",a,function(a){a=JSON.parse(a);0===a.code?(c.stat.message=null,c.stat.mediaHtml=null,c.load(a.response)):c.load(c.stat.editing);c.timeAgo();c.stat.editing=!1},function(){c.load(c.stat.editing);
c.timeAgo();c.stat.editing=!1})):(a={thread:c.stat.thread,parent:d,message:a,name:c.guest.name,email:c.guest.email,url:c.guest.url,link:c.opts.url,title:c.opts.title},m(c.opts.api+"/postcomment.php",a,function(a){a=JSON.parse(a);0===a.code?(c.dom.querySelector('.comment-item[data-id="preview"]').outerHTML="",c.stat.count+=1,c.dom.querySelector("#comment-count").innerHTML=c.stat.count+" \u6761\u8bc4\u8bba",a=a.response,a.isPost=!0,c.load(a),c.timeAgo()):2===a.code&&(p.innerHTML=a.response,c.dom.querySelector('.comment-item[data-id="preview"]').outerHTML=
"",c.reEdit(b),-1<a.response.indexOf("author")&&c.handle.guestReset())},function(){p.innerHTML="\u63d0\u4ea4\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002";alertClear();c.dom.querySelector('.comment-item[data-id="preview"]').outerHTML="";c.reEdit(b)}))};f.prototype.reEdit=function(a){a.dataset.id?a.querySelector(".comment-item-reply").click():a.querySelector(".comment-form-wrapper").classList.add("editing");this.stat.message&&(a.querySelector(".comment-form-textarea").value=this.stat.message);
this.stat.mediaHtml&&(a.querySelector(".comment-form-wrapper").classList.add("expanded"),a.querySelector(".comment-image-list").innerHTML=this.stat.mediaHtml,h(a.getElementsByClassName("comment-image-item"),"click",this.handle.remove))};f.prototype.edit=function(a){var c=this,b=c.box.replace("comment-box","comment-box comment-box-"+a.id).replace(/emoji-input/g,"emoji-input-"+a.id).replace(/upload-input/g,"upload-input-"+a.id);c.dom.querySelector('.comment-item[data-id="'+a.id+'"] .comment-item-body').outerHTML=
b;c.guest.init();b=c.dom.querySelector(".comment-box-"+a.id);b.dataset.currentId=a.id;b.querySelector(".comment-form-textarea").addEventListener("blur",c.handle.focus,!1);b.querySelector(".comment-form-textarea").addEventListener("focus",c.handle.focus,!1);b.querySelector(".comment-form-textarea").addEventListener("input",c.handle.input,!1);b.querySelector(".comment-form-textarea").addEventListener("keyup",c.handle.mention,!1);b.querySelector(".comment-form-email").addEventListener("blur",c.handle.verify,
!1);b.querySelector(".comment-form-submit").addEventListener("click",c.handle.post,!1);b.querySelector(".comment-image-input").addEventListener("change",c.handle.upload,!1);h(b.getElementsByClassName("emojione-item"),"click",c.handle.field);b.querySelector(".comment-form-textarea").focus();b.querySelector(".comment-actions-form").insertAdjacentHTML("afterbegin",'<a class="comment-form-cancel" href="javascript:;">\u53d6\u6d88</a>');b.querySelector(".comment-form-cancel").addEventListener("click",function(){c.stat.editing=
!1;c.load(a);c.timeAgo()},!1);c.stat.message&&(b.querySelector(".comment-form-textarea").value=c.stat.message);c.stat.mediaHtml&&(b.querySelector(".comment-form-wrapper").classList.add("expanded"),b.querySelector(".comment-image-list").innerHTML=c.stat.mediaHtml,h(b.getElementsByClassName("comment-image-item"),"click",c.handle.remove))};f.prototype.create=function(){this.opts.auto?(this.dom.querySelector(".loading-container").dataset.tip="\u6b63\u5728\u521b\u5efa Thread\u2026\u2026",this.postThread({url:this.opts.link,
identifier:this.opts.identifier,title:this.opts.title,slug:this.opts.slug,message:this.opts.desc})):(this.dom.querySelector("#idisqus").classList.remove("loading"),this.dom.querySelector("#idisqus").innerHTML='<div class="comment-header"><span class="comment-header-item">\u521b\u5efa Thread</span></div><div class="comment-thread-form"><p>\u7531\u4e8e Disqus \u6ca1\u6709\u672c\u9875\u9762\u7684\u76f8\u5173 Thread\uff0c\u6545\u9700\u5148\u521b\u5efa Thread</p><div class="comment-form-item"><label class="comment-form-label">url:</label><input class="comment-form-input" id="thread-url" name="url" value="'+
this.opts.link+'" disabled /></div><div class="comment-form-item"><label class="comment-form-label">identifier:</label><input class="comment-form-input" id="thread-identifier" name="identifier" value="'+this.opts.identifier+'" disabled /></div><div class="comment-form-item"><label class="comment-form-label">title:</label><input class="comment-form-input" id="thread-title" name="title" value="'+this.opts.title+'" disabled /></div><div class="comment-form-item"><label class="comment-form-label">slug:</label><input class="comment-form-input" id="thread-slug" name="slug" value="'+
this.opts.slug+'" /></div><div class="comment-form-item"><label class="comment-form-label">message:</label><textarea class="comment-form-textarea" id="thread-message" name="message">'+this.opts.desc+'</textarea></div><button id="thread-submit" class="comment-form-submit">\u63d0\u4ea4</button></div>',this.dom.querySelector("#thread-submit").addEventListener("click",this.handle.postThread,!1))};f.prototype.postThread=function(a){a=a.target?{url:this.dom.querySelector("#thread-url").value,identifier:this.dom.querySelector("#thread-identifier").value,
title:this.dom.querySelector("#thread-title").value,slug:this.dom.querySelector("#thread-slug").value.replace(/[^A-Za-z0-9_-]+/g,""),message:this.dom.querySelector("#thread-message").value}:a;m(this.opts.api+"/createthread.php",a,function(a){a=JSON.parse(a);if(0===a.code)alert("\u521b\u5efa Thread \u6210\u529f\uff0c\u5237\u65b0\u540e\u4fbf\u53ef\u6109\u5feb\u5730\u8bc4\u8bba\u4e86\uff01"),setTimeout(function(){location.reload()},2E3);else{if(2===a.code){if(-1<a.response.indexOf("A thread already exists with link")){alert(a.response.replace("A thread already exists with link,",
"\u5df2\u5b58\u5728\u6b64\u94fe\u63a5\u7684\u76f8\u5173 Thread\uff0c"));return}if(-1<a.response.indexOf("Invalid URL")){alert("\u53c2\u6570\u9519\u8bef\uff0c\u65e0\u6548\u7684'URL'");return}if(-1<a.response.indexOf("Invalid slug")){alert("\u53c2\u6570\u9519\u8bef\uff0c\u65e0\u6548\u7684'slug'");return}}alert(a.response)}},function(){alert("\u521b\u5efa Thread \u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01")})};f.prototype.destroy=function(){this.dom.querySelector(".exit").removeEventListener("click",
this.handle.guestReset,!1);l(this.dom.getElementsByClassName("comment-form-textarea"),"blur",this.handle.focus);l(this.dom.getElementsByClassName("comment-form-textarea"),"focus",this.handle.focus);l(this.dom.getElementsByClassName("comment-form-textarea"),"keyup",this.handle.mention);l(this.dom.getElementsByClassName("comment-form-email"),"blur",this.handle.verify);l(this.dom.getElementsByClassName("comment-form-submit"),"click",this.handle.post);l(this.dom.getElementsByClassName("comment-image-input"),
"change",this.handle.upload);l(this.dom.getElementsByClassName("comment-item-reply"),"click",this.handle.show);l(this.dom.getElementsByClassName("comment-loadmore"),"click",this.handle.loadMore);l(this.dom.getElementsByClassName("emojione-item"),"click",this.handle.field);this.dom.innerHTML="";delete this.box;delete this.dom;delete this.emoji_list;delete this.guest;delete this.handle;delete this.opts;delete this.stat};"function"===typeof require&&"object"===typeof module&&module&&"object"===typeof exports&&
exports?module.exports=f:"function"===typeof define&&define.amd?define(function(){return f}):d.iDisqus=d.iDisqus||f})(window||this);
