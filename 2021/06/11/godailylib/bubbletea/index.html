<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Go 每日一库之 bubbletea - 大俊的博客</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="darjun" />
  <meta name="description" content="简介 bubbletea是一个简单、小巧、可以非常方便地用来编写 TUI（terminal User Interface，控制台界面程序）程序的框架。内置" />

  <meta name="keywords" content="大俊, 大俊的博客, go, golang, gopher" />






<meta name="generator" content="Hugo 0.84.0-DEV" />


<link rel="canonical" href="https://darjun.github.io/2021/06/11/godailylib/bubbletea/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa3d941d1d0e0ddc985804227feabffea55c89883eb0af34e0532a7ae9135151.css" integrity="sha256-&#43;j2UHR0ODdyYWAQif&#43;q//qVciYg&#43;sK804FMqeukTUVE=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/custom.css">


<meta property="og:title" content="Go 每日一库之 bubbletea" />
<meta property="og:description" content="简介 bubbletea是一个简单、小巧、可以非常方便地用来编写 TUI（terminal User Interface，控制台界面程序）程序的框架。内置" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://darjun.github.io/2021/06/11/godailylib/bubbletea/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-06-11T07:47:23&#43;00:00" />
<meta property="article:modified_time" content="2021-06-11T07:47:23&#43;00:00" />

<meta itemprop="name" content="Go 每日一库之 bubbletea">
<meta itemprop="description" content="简介 bubbletea是一个简单、小巧、可以非常方便地用来编写 TUI（terminal User Interface，控制台界面程序）程序的框架。内置"><meta itemprop="datePublished" content="2021-06-11T07:47:23&#43;00:00" />
<meta itemprop="dateModified" content="2021-06-11T07:47:23&#43;00:00" />
<meta itemprop="wordCount" content="4267">
<meta itemprop="keywords" content="Go 每日一库," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go 每日一库之 bubbletea"/>
<meta name="twitter:description" content="简介 bubbletea是一个简单、小巧、可以非常方便地用来编写 TUI（terminal User Interface，控制台界面程序）程序的框架。内置"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-42862533-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">大俊</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/about/">关于我</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/darjun" rel="noopener" target="_blank">
              Github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      大俊
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://darjun.github.io/about/">关于我</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/darjun" rel="noopener" target="_blank">
              Github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Go 每日一库之 bubbletea</h1>
      
      <div class="post-meta">
        <time datetime="2021-06-11" class="post-time">
          2021-06-11
        </time>
        <div class="post-category">
            <a href="https://darjun.github.io/categories/go/"> Go </a>
            
          </div>
        <span class="more-meta"> 约 4267 字 </span>
          <span class="more-meta"> 预计阅读 9 分钟 </span>

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#快速使用">快速使用</a></li>
    <li><a href="#github-trending">GitHub Trending</a>
      <ul>
        <li><a href="#基础版本">基础版本</a></li>
        <li><a href="#让界面更美观">让界面更美观</a></li>
        <li><a href="#我没有偷懒">我没有偷懒</a></li>
        <li><a href="#分页">分页</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a></li>
    <li><a href="#参考">参考</a></li>
    <li><a href="#我">我</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h2 id="简介">简介</h2>
<p><a href="https://github.com/charmbracelet/bubbletea"><code>bubbletea</code></a>是一个简单、小巧、可以非常方便地用来编写 TUI（terminal User Interface，控制台界面程序）程序的框架。内置简单的事件处理机制，可以对外部事件做出响应，如键盘按键。一起来看下吧。先看看<code>bubbletea</code>能做出什么效果：</p>
<p><img src="/img/in-post/godailylib/bubbletea0.gif#center" alt=""></p>
<h2 id="快速使用">快速使用</h2>
<p>本文代码使用 Go Modules。</p>
<p>创建目录并初始化：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">$ mkdir bubbletea <span class="p">&amp;&amp;</span> <span class="k">cd</span> bubbletea
$ go mod init github.com/darjun/go-daily-lib/bubbletea
</code></pre></td></tr></table>
</div>
</div><p>安装<code>bubbletea</code>库：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">$ go get -u github.com/charmbracelet/bubbletea
</code></pre></td></tr></table>
</div>
</div><p><code>bubbletea</code>程序都需要有一个实现<code>bubbletea.Model</code>接口的类型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">type</span> <span class="nx">Model</span> <span class="kd">interface</span> <span class="p">{</span>
  <span class="nf">Init</span><span class="p">()</span> <span class="nx">Cmd</span>
  <span class="nf">Update</span><span class="p">(</span><span class="nx">Msg</span><span class="p">)</span> <span class="p">(</span><span class="nx">Model</span><span class="p">,</span> <span class="nx">Cmd</span><span class="p">)</span>
  <span class="nf">View</span><span class="p">()</span> <span class="kt">string</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Init()</code>方法在程序启动时会立刻调用，它会做一些初始化工作，并返回一个<code>Cmd</code>告诉<code>bubbletea</code>要执行什么命令；</li>
<li><code>Update()</code>方法用来响应外部事件，返回一个修改后的模型，和想要<code>bubbletea</code>执行的命令；</li>
<li><code>View()</code>方法用于返回在控制台上显示的文本字符串。</li>
</ul>
<p>下面我们来实现一个 Todo List。首先定义模型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">type</span> <span class="nx">model</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">todos</span>    <span class="p">[]</span><span class="kt">string</span>
  <span class="nx">cursor</span>   <span class="kt">int</span>
  <span class="nx">selected</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kd">struct</span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>todos</code>：所有待完成事项；</li>
<li><code>cursor</code>：界面上光标位置；</li>
<li><code>selected</code>：已完成标识。</li>
</ul>
<p>不需要任何初始化工作，实现一个空的<code>Init()</code>方法，并返回<code>nil</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kn">import</span> <span class="p">(</span>
  <span class="nx">tea</span> <span class="s">&#34;github.com/charmbracelet/bubbletea&#34;</span>
<span class="p">)</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">model</span><span class="p">)</span> <span class="nf">Init</span><span class="p">()</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Cmd</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们需要响应按键事件，实现<code>Update()</code>方法。按键事件发生时会以相应的<code>tea.Msg</code>为参数调用<code>Update()</code>方法。通过对参数<code>tea.Msg</code>进行类型断言，我们可以对不同的事件进行对应的处理：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">model</span><span class="p">)</span> <span class="nf">Update</span><span class="p">(</span><span class="nx">msg</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Msg</span><span class="p">)</span> <span class="p">(</span><span class="nx">tea</span><span class="p">.</span><span class="nx">Model</span><span class="p">,</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Cmd</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="nx">msg</span> <span class="o">:=</span> <span class="nx">msg</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">KeyMsg</span><span class="p">:</span>
    <span class="k">switch</span> <span class="nx">msg</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s">&#34;ctrl+c&#34;</span><span class="p">,</span> <span class="s">&#34;q&#34;</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Quit</span>

    <span class="k">case</span> <span class="s">&#34;up&#34;</span><span class="p">,</span> <span class="s">&#34;k&#34;</span><span class="p">:</span>
      <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">cursor</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">m</span><span class="p">.</span><span class="nx">cursor</span><span class="o">--</span>
      <span class="p">}</span>

    <span class="k">case</span> <span class="s">&#34;down&#34;</span><span class="p">,</span> <span class="s">&#34;j&#34;</span><span class="p">:</span>
      <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">cursor</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">todos</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
        <span class="nx">m</span><span class="p">.</span><span class="nx">cursor</span><span class="o">++</span>
      <span class="p">}</span>

    <span class="k">case</span> <span class="s">&#34;enter&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">:</span>
      <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">selected</span><span class="p">[</span><span class="nx">m</span><span class="p">.</span><span class="nx">cursor</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
        <span class="nb">delete</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">selected</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">cursor</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">m</span><span class="p">.</span><span class="nx">selected</span><span class="p">[</span><span class="nx">m</span><span class="p">.</span><span class="nx">cursor</span><span class="p">]</span> <span class="p">=</span> <span class="kd">struct</span><span class="p">{}{}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>约定：</p>
<ul>
<li><code>ctrl+c</code>或<code>q</code>：退出程序；</li>
<li><code>up</code>或<code>k</code>：向上移动光标；</li>
<li><code>down</code>或<code>j</code>：向下移动光标；</li>
<li><code>enter</code>或<code> </code>：切换光标处事项的完成状态。</li>
</ul>
<p>处理<code>ctrl+c</code>或<code>q</code>按键时，返回一个特殊的<code>tea.Quit</code>，通知<code>bubbletea</code>需要退出程序。</p>
<p>最后实现<code>View()</code>方法，这个方法返回的字符串就是最终显示在控制台上的文本。我们可以按照自己想要的形式，根据模型数据拼装：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">model</span><span class="p">)</span> <span class="nf">View</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="nx">s</span> <span class="o">:=</span> <span class="s">&#34;todo list:\n\n&#34;</span>

  <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">choice</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span><span class="p">.</span><span class="nx">todos</span> <span class="p">{</span>
    <span class="nx">cursor</span> <span class="o">:=</span> <span class="s">&#34; &#34;</span>
    <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">==</span> <span class="nx">i</span> <span class="p">{</span>
      <span class="nx">cursor</span> <span class="p">=</span> <span class="s">&#34;&gt;&#34;</span>
    <span class="p">}</span>

    <span class="nx">checked</span> <span class="o">:=</span> <span class="s">&#34; &#34;</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">selected</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
      <span class="nx">checked</span> <span class="p">=</span> <span class="s">&#34;x&#34;</span>
    <span class="p">}</span>

    <span class="nx">s</span> <span class="o">+=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s [%s] %s\n&#34;</span><span class="p">,</span> <span class="nx">cursor</span><span class="p">,</span> <span class="nx">checked</span><span class="p">,</span> <span class="nx">choice</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">s</span> <span class="o">+=</span> <span class="s">&#34;\nPress q to quit.\n&#34;</span>
  <span class="k">return</span> <span class="nx">s</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>光标所在位置用<code>&gt;</code>标识，已完成的事项增加<code>x</code>标识。</p>
<p>模型类型定义好了之后，需要创建一个该模型的对象；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">var</span> <span class="nx">initModel</span> <span class="p">=</span> <span class="nx">model</span><span class="p">{</span>
  <span class="nx">todos</span><span class="p">:</span>    <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;cleanning&#34;</span><span class="p">,</span> <span class="s">&#34;wash clothes&#34;</span><span class="p">,</span> <span class="s">&#34;write a blog&#34;</span><span class="p">},</span>
  <span class="nx">selected</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kd">struct</span><span class="p">{}),</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>为了让程序工作，我们还要创建一个<code>bubbletea</code>的应用对象，通过<code>bubbletea.NewProgram()</code>完成，然后调用这个对象的<code>Start()</code>方法开始执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">tea</span><span class="p">.</span><span class="nf">NewProgram</span><span class="p">(</span><span class="nx">initModel</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;start failed:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="nx">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>运行：</p>
<p><img src="/img/in-post/godailylib/bubbletea1.gif" alt=""></p>
<h2 id="github-trending">GitHub Trending</h2>
<p>一个简单的 Todo 应用看起来好像没什么意思。接下来，我们一起编写一个拉取 GitHub Trending 仓库并显示在控制台的程序。</p>
<p>Github Trending 的界面如下：</p>
<p><img src="/img/in-post/godailylib/bubbletea2.png#center" alt=""></p>
<p>可以选择语言（Spoken Language，本地语言）、语言（Language，编程语言）和时间范围（Today，This week，This month）。由于 GitHub 没有提供 trending 的官方 API，我们只能爬取网页自己来分析。好在 Go 有一个强大的分析工具<a href="https://github.com/PuerkitoBio/goquery">goquery</a>，提供了堪比 jQuery 的强大功能。我之前也写过一篇文章介绍它——<a href="https://darjun.github.io/2020/10/11/godailylib/goquery">Go 每日一库之 goquery</a>。</p>
<p>打开 Chrome 控制台，点击 Elements 页签，查看每个条目的结构：</p>
<p><img src="/img/in-post/godailylib/bubbletea3.png#center" alt=""></p>
<h3 id="基础版本">基础版本</h3>
<p>定义模型：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">type</span> <span class="nx">model</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">repos</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Repo</span>
  <span class="nx">err</span>   <span class="kt">error</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>其中<code>repos</code>字段表示拉取到的 Trending 仓库列表，结构体<code>Repo</code>如下，字段含义都有注释，很清晰了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">type</span> <span class="nx">Repo</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Name</span>    <span class="kt">string</span>   <span class="c1">// 仓库名
</span><span class="c1"></span>  <span class="nx">Author</span>  <span class="kt">string</span>   <span class="c1">// 作者名
</span><span class="c1"></span>  <span class="nx">Link</span>    <span class="kt">string</span>   <span class="c1">// 链接
</span><span class="c1"></span>  <span class="nx">Desc</span>    <span class="kt">string</span>   <span class="c1">// 描述
</span><span class="c1"></span>  <span class="nx">Lang</span>    <span class="kt">string</span>   <span class="c1">// 语言
</span><span class="c1"></span>  <span class="nx">Stars</span>   <span class="kt">int</span>      <span class="c1">// 星数
</span><span class="c1"></span>  <span class="nx">Forks</span>   <span class="kt">int</span>      <span class="c1">// fork 数
</span><span class="c1"></span>  <span class="nx">Add</span>     <span class="kt">int</span>      <span class="c1">// 周期内新增
</span><span class="c1"></span>  <span class="nx">BuiltBy</span> <span class="p">[]</span><span class="kt">string</span> <span class="c1">// 贡献值 avatar img 链接
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>err</code>字段表示拉取失败设置的错误值。为了让程序启动时，就去执行网络请求拉取 Trending 的列表，我们让模型的<code>Init()</code>方法返回一个<code>tea.Cmd</code>类型的值：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">model</span><span class="p">)</span> <span class="nf">Init</span><span class="p">()</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Cmd</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fetchTrending</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">fetchTrending</span><span class="p">()</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Msg</span> <span class="p">{</span>
  <span class="nx">repos</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">getTrending</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;daily&#34;</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">errMsg</span><span class="p">{</span><span class="nx">err</span><span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">repos</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>tea.Cmd</code>类型为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="c1">// src/github.com/charmbracelet/bubbletea/tea.go
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Cmd</span> <span class="kd">func</span><span class="p">()</span> <span class="nx">Msg</span>
</code></pre></td></tr></table>
</div>
</div><p><code>tea.Cmd</code>底层是一个函数类型，函数无参数，并且返回一个<code>tea.Msg</code>对象。</p>
<p><code>fetchTrending()</code>函数拉取 GitHub 的今日 Trending 列表，如果遇到错误，则返回<code>error</code>值。这里我们暂时忽略<code>getTrending()</code>函数的实现，这个与我们要说的重点关系不大，感兴趣的童鞋可以去我的 GitHub 仓库查看详细代码。</p>
<p>程序启动时如果需要做一些操作，通常就会在<code>Init()</code>方法中返回一个<code>tea.Cmd</code>。<code>tea</code>后台会执行这个函数，最终将返回的<code>tea.Msg</code>传给模型的<code>Update()</code>方法。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">model</span><span class="p">)</span> <span class="nf">Update</span><span class="p">(</span><span class="nx">msg</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Msg</span><span class="p">)</span> <span class="p">(</span><span class="nx">tea</span><span class="p">.</span><span class="nx">Model</span><span class="p">,</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Cmd</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="nx">msg</span> <span class="o">:=</span> <span class="nx">msg</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">KeyMsg</span><span class="p">:</span>
    <span class="k">switch</span> <span class="nx">msg</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s">&#34;q&#34;</span><span class="p">,</span> <span class="s">&#34;ctrl+c&#34;</span><span class="p">,</span> <span class="s">&#34;esc&#34;</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Quit</span>
    <span class="k">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
    <span class="p">}</span>

  <span class="k">case</span> <span class="nx">errMsg</span><span class="p">:</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">err</span> <span class="p">=</span> <span class="nx">msg</span>
    <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>

  <span class="k">case</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Repo</span><span class="p">:</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">repos</span> <span class="p">=</span> <span class="nx">msg</span>
    <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>

  <span class="k">default</span><span class="p">:</span>
    <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Update()</code>方法也比较简单，首先还是需要监听按键事件，我们约定按下 q 或 ctrl+c 或 esc 退出程序。<strong>具体按键对应的字符串表示可以查看文档或源码<code>bubbletea/key.go</code>文件</strong>。接收到<code>errMsg</code>类型的消息，表示网络请求失败了，记录错误值。接收到<code>[]*Repo</code>类型的消息，表示正确返回的 Trending 仓库列表，记录下来。在<code>View()</code>函数中，我们显示正在拉取，拉取失败和正确拉取等信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">model</span><span class="p">)</span> <span class="nf">View</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">s</span> <span class="kt">string</span>
  <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;Fetch trending failed: %v&#34;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">repos</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">repo</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span><span class="p">.</span><span class="nx">repos</span> <span class="p">{</span>
      <span class="nx">s</span> <span class="o">+=</span> <span class="nf">repoText</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">s</span> <span class="o">+=</span> <span class="s">&#34;--------------------------------------&#34;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="p">=</span> <span class="s">&#34; Fetching GitHub trending ...&#34;</span>
  <span class="p">}</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="s">&#34;\n\n&#34;</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="s">&#34;Press q or ctrl + c or esc to exit...&#34;</span>
  <span class="k">return</span> <span class="nx">s</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>逻辑很清晰，如果<code>err</code>字段不为<code>nil</code>表示失败，否则有仓库数据，显示仓库信息。否则正在拉取中。最后显示一条提示信息，告诉客户怎么退出程序。</p>
<p>每个仓库项的显示逻辑如下，分为 3 列，基础信息、描述和链接：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="nf">repoText</span><span class="p">(</span><span class="nx">repo</span> <span class="o">*</span><span class="nx">Repo</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="nx">s</span> <span class="o">:=</span> <span class="s">&#34;--------------------------------------\n&#34;</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">`Repo:  %s | Language:  %s | Stars:  %d | Forks:  %d | Stars today:  %d
</span><span class="s">`</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Lang</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Stars</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Forks</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Add</span><span class="p">)</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;Desc:  %s\n&#34;</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Desc</span><span class="p">)</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;Link:  %s\n&#34;</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">Link</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">s</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>运行（多文件运行不能用<code>go run main.go</code>）：</p>
<p><img src="/img/in-post/godailylib/bubbletea4.png#center" alt=""></p>
<p>获取失败（国内 GitHub 不稳定，多试几次总会遇到😭）：</p>
<p><img src="/img/in-post/godailylib/bubbletea5.png#center" alt=""></p>
<p>获取成功：</p>
<p><img src="/img/in-post/godailylib/bubbletea6.png#center" alt=""></p>
<h3 id="让界面更美观">让界面更美观</h3>
<p>黑白色我们已经看了太多太多了，能不能让字体呈现不同的颜色呢？当然可以。<code>bubbletea</code>可以利用<code>lipgloss</code>库给文本添加各种颜色，我们定义了 4 种颜色，颜色的 RBG 值是我在<a href="http://tool.chinaz.com/tools/pagecolor.aspx">http://tool.chinaz.com/tools/pagecolor.aspx</a>挑的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">var</span> <span class="p">(</span>
  <span class="nx">cyan</span>  <span class="p">=</span> <span class="nx">lipgloss</span><span class="p">.</span><span class="nf">NewStyle</span><span class="p">().</span><span class="nf">Foreground</span><span class="p">(</span><span class="nx">lipgloss</span><span class="p">.</span><span class="nf">Color</span><span class="p">(</span><span class="s">&#34;#00FFFF&#34;</span><span class="p">))</span>
  <span class="nx">green</span> <span class="p">=</span> <span class="nx">lipgloss</span><span class="p">.</span><span class="nf">NewStyle</span><span class="p">().</span><span class="nf">Foreground</span><span class="p">(</span><span class="nx">lipgloss</span><span class="p">.</span><span class="nf">Color</span><span class="p">(</span><span class="s">&#34;#32CD32&#34;</span><span class="p">))</span>
  <span class="nx">gray</span>  <span class="p">=</span> <span class="nx">lipgloss</span><span class="p">.</span><span class="nf">NewStyle</span><span class="p">().</span><span class="nf">Foreground</span><span class="p">(</span><span class="nx">lipgloss</span><span class="p">.</span><span class="nf">Color</span><span class="p">(</span><span class="s">&#34;#696969&#34;</span><span class="p">))</span>
  <span class="nx">gold</span>  <span class="p">=</span> <span class="nx">lipgloss</span><span class="p">.</span><span class="nf">NewStyle</span><span class="p">().</span><span class="nf">Foreground</span><span class="p">(</span><span class="nx">lipgloss</span><span class="p">.</span><span class="nf">Color</span><span class="p">(</span><span class="s">&#34;#B8860B&#34;</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>想要将文本变为什么颜色，只需要调用对应颜色对象的<code>Render()</code>方法将文本传入即可。例如我们想让提示变为暗灰色，中间文字使用暗黄色，修改<code>View()</code>方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">model</span><span class="p">)</span> <span class="nf">View</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">s</span> <span class="kt">string</span>
  <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="p">=</span> <span class="nx">gold</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;fetch trending failed: %v&#34;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">err</span><span class="p">))</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">repos</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">repo</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span><span class="p">.</span><span class="nx">repos</span> <span class="p">{</span>
      <span class="nx">s</span> <span class="o">+=</span> <span class="nf">repoText</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">s</span> <span class="o">+=</span> <span class="nx">cyan</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="s">&#34;--------------------------------------&#34;</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="p">=</span> <span class="nx">gold</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="s">&#34; Fetching GitHub trending ...&#34;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="s">&#34;\n\n&#34;</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nx">gray</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="s">&#34;Press q or ctrl + c or esc to exit...&#34;</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">s</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>然后仓库的基本信息我们用青色（cyan），描述用绿色，链接用暗灰色：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="nf">repoText</span><span class="p">(</span><span class="nx">repo</span> <span class="o">*</span><span class="nx">Repo</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="nx">s</span> <span class="o">:=</span> <span class="nx">cyan</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="s">&#34;--------------------------------------&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">`Repo:  %s | Language:  %s | Stars:  %s | Forks:  %s | Stars today:  %s
</span><span class="s">`</span><span class="p">,</span> <span class="nx">cyan</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">Name</span><span class="p">),</span> <span class="nx">cyan</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">Lang</span><span class="p">),</span> <span class="nx">cyan</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nf">Itoa</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">Stars</span><span class="p">)),</span>
    <span class="nx">cyan</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nf">Itoa</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">Forks</span><span class="p">)),</span> <span class="nx">cyan</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nf">Itoa</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">Add</span><span class="p">)))</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;Desc:  %s\n&#34;</span><span class="p">,</span> <span class="nx">green</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">Desc</span><span class="p">))</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;Link:  %s\n&#34;</span><span class="p">,</span> <span class="nx">gray</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">Link</span><span class="p">))</span>
  <span class="k">return</span> <span class="nx">s</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>再次运行：</p>
<p><img src="/img/in-post/godailylib/bubbletea7.png#center" alt=""></p>
<p>成功：</p>
<p><img src="/img/in-post/godailylib/bubbletea8.png#center" alt=""></p>
<p>嗯，现在好看多了。</p>
<h3 id="我没有偷懒">我没有偷懒</h3>
<p>有时候网络很慢，加上一个请求正在处理的提示能让我们更放心（程序还在跑，没偷懒）。<code>bubbletea</code>的兄弟仓库<code>bubbles</code>提供了一个叫做<code>spinner</code>的组件，它只是显示一些字符，一直在变化，给我们造成一种任务正在处理中的感觉。<code>spinner</code>在<code>github.com/charmbracelet/bubbles/spinner</code>包中，需要先引入。然后在模型中增加<code>spinner.Model</code>字段：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">type</span> <span class="nx">model</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">repos</span>   <span class="p">[]</span><span class="o">*</span><span class="nx">Repo</span>
  <span class="nx">err</span>     <span class="kt">error</span>
  <span class="nx">spinner</span> <span class="nx">spinner</span><span class="p">.</span><span class="nx">Model</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>创建模型时，同时需要初始化<code>spinner.Model</code>对象，我们指定<code>spinner</code>的文本颜色为紫色：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">var</span> <span class="nx">purple</span> <span class="p">=</span> <span class="nx">lipgloss</span><span class="p">.</span><span class="nf">NewStyle</span><span class="p">().</span><span class="nf">Foreground</span><span class="p">(</span><span class="nx">lipgloss</span><span class="p">.</span><span class="nf">Color</span><span class="p">(</span><span class="s">&#34;#800080&#34;</span><span class="p">))</span>

<span class="kd">func</span> <span class="nf">newModel</span><span class="p">()</span> <span class="nx">model</span> <span class="p">{</span>
  <span class="nx">sp</span> <span class="o">:=</span> <span class="nx">spinner</span><span class="p">.</span><span class="nf">NewModel</span><span class="p">()</span>
  <span class="nx">sp</span><span class="p">.</span><span class="nx">Style</span> <span class="p">=</span> <span class="nx">purple</span>

  <span class="k">return</span> <span class="nx">model</span><span class="p">{</span>
    <span class="nx">spinner</span><span class="p">:</span> <span class="nx">sp</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>spinner</code>通过<code>Tick</code>来触发其改变状态，所以需要在<code>Init()</code>方法中返回触发<code>Tick</code>的<code>Cmd</code>。但是又需要返回<code>fetchTrending</code>。<code>bubbletea</code>提供了<code>Batch</code>可以将两个<code>Cmd</code>合并在一起返回：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">model</span><span class="p">)</span> <span class="nf">Init</span><span class="p">()</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Cmd</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">tea</span><span class="p">.</span><span class="nf">Batch</span><span class="p">(</span>
    <span class="nx">spinner</span><span class="p">.</span><span class="nx">Tick</span><span class="p">,</span>
    <span class="nx">fetchTrending</span><span class="p">,</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>然后<code>Update()</code>方法中我们需要更新<code>spinner</code>。<code>Init()</code>方法返回的<code>spinner.Tick</code>会产生<code>spinner.TickMsg</code>，我们对其做处理：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="k">case</span> <span class="nx">spinner</span><span class="p">.</span><span class="nx">TickMsg</span><span class="p">:</span>
  <span class="kd">var</span> <span class="nx">cmd</span> <span class="nx">tea</span><span class="p">.</span><span class="nx">Cmd</span>
  <span class="nx">m</span><span class="p">.</span><span class="nx">spinner</span><span class="p">,</span> <span class="nx">cmd</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">spinner</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">cmd</span>
</code></pre></td></tr></table>
</div>
</div><p><code>spinner.Update(msg)</code>返回一个<code>tea.Cmd</code>对象驱动下一次<code>Tick</code>。</p>
<p>最后在<code>View()</code>方法中，我们将<code>spinner</code>显示出来。调用其<code>View()</code>方法返回当前状态的字符串，拼在我们想要显示的位置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">model</span><span class="p">)</span> <span class="nf">View</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">s</span> <span class="kt">string</span>
  <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="p">=</span> <span class="nx">gold</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;fetch trending failed: %v&#34;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">err</span><span class="p">))</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">repos</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">repo</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span><span class="p">.</span><span class="nx">repos</span> <span class="p">{</span>
      <span class="nx">s</span> <span class="o">+=</span> <span class="nf">repoText</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">s</span> <span class="o">+=</span> <span class="nx">cyan</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="s">&#34;--------------------------------------&#34;</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 这里
</span><span class="c1"></span>    <span class="nx">s</span> <span class="p">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">spinner</span><span class="p">.</span><span class="nf">View</span><span class="p">()</span> <span class="o">+</span> <span class="nx">gold</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="s">&#34; Fetching GitHub trending ...&#34;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="s">&#34;\n\n&#34;</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nx">gray</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="s">&#34;Press q or ctrl + c or esc to exit...&#34;</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">s</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>运行：</p>
<p><img src="/img/in-post/godailylib/bubbletea9.gif#center" alt=""></p>
<h3 id="分页">分页</h3>
<p>由于一次返回了很多 GitHub 仓库，我们想对其进行分页显示，每页显示 5 条，可以按<code>pageup</code>和<code>pagedown</code>翻页。首先在模型中增加两个字段，当前页和总页数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">const</span> <span class="p">(</span>
  <span class="nx">CountPerPage</span> <span class="p">=</span> <span class="mi">5</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">model</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span>  <span class="nx">curPage</span>   <span class="kt">int</span>
  <span class="nx">totalPage</span> <span class="kt">int</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>拉取到仓库时，计算总页数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="k">case</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Repo</span><span class="p">:</span>
  <span class="nx">m</span><span class="p">.</span><span class="nx">repos</span> <span class="p">=</span> <span class="nx">msg</span>
  <span class="nx">m</span><span class="p">.</span><span class="nx">totalPage</span> <span class="p">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">+</span> <span class="nx">CountPerPage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nx">CountPerPage</span>
  <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
</code></pre></td></tr></table>
</div>
</div><p>另外需要监听翻页按键：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="k">case</span> <span class="s">&#34;pgdown&#34;</span><span class="p">:</span>
  <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">curPage</span> <span class="p">&lt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">totalPage</span><span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">curPage</span><span class="o">++</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
<span class="k">case</span> <span class="s">&#34;pgup&#34;</span><span class="p">:</span>
  <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">curPage</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">curPage</span><span class="o">--</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">m</span><span class="p">,</span> <span class="kc">nil</span>
</code></pre></td></tr></table>
</div>
</div><p>在<code>View()</code>方法中，我们根据当前页计算需要显示哪些仓库：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="o">:=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">curPage</span><span class="o">*</span><span class="nx">CountPerPage</span><span class="p">,</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">curPage</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">CountPerPage</span>
<span class="k">if</span> <span class="nx">end</span> <span class="p">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">repos</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">end</span> <span class="p">=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">repos</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">repo</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span><span class="p">.</span><span class="nx">repos</span><span class="p">[</span><span class="nx">start</span><span class="p">:</span><span class="nx">end</span><span class="p">]</span> <span class="p">{</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nf">repoText</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">s</span> <span class="o">+=</span> <span class="nx">cyan</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="s">&#34;--------------------------------------&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>最后，如果总页数大于 1，给出翻页按键的提示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-golang" data-lang="golang"><span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">totalPage</span> <span class="p">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="nx">gray</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="s">&#34;Pagedown to next page, pageup to prev page.&#34;</span><span class="p">)</span>
  <span class="nx">s</span> <span class="o">+=</span> <span class="s">&#34;\n&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>运行：</p>
<p><img src="/img/in-post/godailylib/bubbletea10.png#center" alt=""></p>
<p>很棒，我们只显示了 5 页。试试翻页吧：</p>
<p><img src="/img/in-post/godailylib/bubbletea11.png#center" alt=""></p>
<h2 id="总结">总结</h2>
<p><code>bubbletea</code>提供了一个 TUI 程序运行的基本框架。我们要显示什么，显示的样式，要对哪些事件进行处理都由我们自己指定。<code>bubbletea</code>仓库的<code>examples</code>文件夹中有多个示例程序，对编写 TUI 程序感兴趣的童鞋千万不能错过。另外它的兄弟仓库<code>bubbles</code>中也提供了不少组件。</p>
<p>大家如果发现好玩、好用的 Go 语言库，欢迎到 Go 每日一库 GitHub 上提交 issue😄</p>
<h2 id="参考">参考</h2>
<ol>
<li>bubbletea GitHub：<a href="https://https://github.com/charmbracelet/bubbletea">https://github.com/charmbracelet/bubbletea</a></li>
<li>bubble GitHub：<a href="https://https://github.com/charmbracelet/bubbles">https://github.com/charmbracelet/bubbles</a></li>
<li>Go 每日一库 GitHub：<a href="https://github.com/darjun/go-daily-lib">https://github.com/darjun/go-daily-lib</a></li>
</ol>
<h2 id="我">我</h2>
<p>我的博客：<a href="https://darjun.github.io">https://darjun.github.io</a></p>
<p>欢迎关注我的微信公众号【GoUpUp】，共同学习，一起进步~</p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">darjun</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2021-06-11
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/2021/06/12/pr/tunny/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">为 tunny 提交的一次 PR</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/2021/06/10/godailylib/tunny/">
            <span class="next-text nav-default">Go 每日一库之 tunny</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "darjun/blog-comments"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:leedarjun@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/darjun" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://darjun.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2018 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        大俊
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>












</body>
</html>
